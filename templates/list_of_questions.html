{% extends "base.html" %}

{% block title %}Question list{% endblock title %}

{% block content %}
<form class="d-inline" action="{{ url_for('display_latest_questions') }}">
    <button class="button_btn" type="submit">Latest questions</button>
</form>

    {% if 'username' in session %}
<form class="d-inline" action="{{ url_for('list_users') }}">
    <button class="button_btn" type="submit">Users list</button>
</form>
    {% endif %}

<form class="d-inline" action="{{ url_for('list_tags') }}">
    <button class="button_btn" type="submit">Tags list</button>
</form><br><br>

<form action="/list">
    <select
        class="form-select form-select-lg mb-3"
        aria-label=".form-select-lg example"
        name="order_by"
    >
        <option value="submission_time" selected>Choose a criteria</option>
        <option value="title">Title</option>
        <option value="submission_time">Time</option>
        <option value="message">Message</option>
        <option value="vote_number">Votes</option>
        <option value="view_number">Views</option>
    </select>

    <select
        class="form-select form-select-lg mb-3"
        aria-label=".form-select-lg example"
        name="order_direction"
    >
        <option value="desc" selected>Choose direction</option>
        <option value="asc">Ascending</option>
        <option value="desc">Descending</option>
    </select>
    <button class="button_btn" type="submit">Sort</button>
</form>

<form
    action="{{ url_for('search_list' , question_id=question_id)}}"
    method="get"
>
    <input type="text" name="info" id="info" required />
    <button class="button_btn" type="submit">Search</button>
</form>

<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>Id</th>
            <th>Submission Time</th>
            <th>View number</th>
            <th>Vote Number</th>
            <th>Title</th>
            <th>Message</th>
            <th>Image</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% if search == None %}
            {% for question in questions %}
                <tr>
                    <td>{{ question.id }}</td>
                    <td>{{ question.submission_time }}</td>
                    <td>{{ question.view_number }}</td>
                    <td>{{ question.vote_number }}</td>
                    <td>
                        <a
                            href="{{ url_for('display_question_by_id', question_id=question.id) }}"
                            >{{ question.title }}</a
                        >
                    </td>
                    <td>{{ question.message }}</td>
                    <td>
                        {% if question.image %}
                        <img
                            src="{{ url_for('static', filename='images/' + question.image) }}"
                            alt="No image found"
                        />
                        {% endif %}
                    </td>
                    <td>
                        <form
                            action="{{ url_for('vote_up_question', question_id=question.id)}}"
                        >
                            <button class="button_btn" type="submit">Vote up</button>
                        </form>
                        <form
                            action="{{ url_for('vote_down_question', question_id=question.id)}}"
                        >
                            <button class="button_btn" type="submit">Vote down</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
        {% endif %}
        
        {% if search != None %}
            {% for answer in date %}
                {% for question in dates %}
                    {% if answer.question_id == question.id %}
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td>{{answer.message}}</td>
                            <td>{{answer.image}}</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>{{ question.id }}</td>
                            <td>{{ question.submission_time }}</td>
                            <td>{{ question.view_number }}</td>
                            <td>{{ question.vote_number }}</td>
                            <td>
                                <a
                                    href="{{ url_for('display_question_by_id', question_id=question.id) }}"
                                    >{{ question.title }}</a
                                >
                            </td>
                            <td>{{ question.message }}</td>
                            <td>
                                {% if question.image %}
                                    <img
                                        src="{{ url_for('static', filename='images/' + question.image) }}"
                                        alt="No image found"
                                    />
                                {% endif %}
                            </td>
                            <td>
                                <form
                                    action="{{ url_for('vote_up_question', question_id=question.id)}}"
                                >
                                    <button class="button_btn" type="submit">Vote up</button>
                                </form>
                                <form
                                    action="{{ url_for('vote_down_question', question_id=question.id)}}"
                                >
                                    <button class="button_btn" type="submit">Vote down</button>
                                </form>
                            </td>
                        </tr>
                    {% endif%}
                {% endfor %}
            {% endfor%}
        {% endif %}
    </tbody>
</table>

{% endblock %}
